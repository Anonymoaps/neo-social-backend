<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Perfil | NEO</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body style="overflow-y: auto;">

    <div class="top-nav" style="position: sticky; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);">
        <a href="/" class="nav-item" style="font-size: 1.5em; text-decoration: none; color: white;">‚Üê</a>
        <div style="font-weight: bold; font-size: 1.1em;">{{ user.username }} <span
                style="font-size:0.8em; color:gold;">{% if user.is_pioneer %}üî∞{% endif %}</span></div>
        <div class="nav-item"><i class="fas fa-ellipsis-h"></i></div>
    </div>

    <div class="profile-header">
        <div style="position:relative; display:inline-block;">
            <img src="{{ user.profile_pic }}" class="p-pic" alt="Profile">
            {% if user.is_pioneer %}
            <div class="pioneer-badge-corner" style="display:flex;">üî∞</div>
            {% endif %}
        </div>

        <div class="p-name">@{{ user.username }}</div>
        <div class="p-bio">{{ user.bio if user.bio else 'Sem bio ainda.' }}</div>

        <div class="p-stats">
            <div class="p-stat-box">
                <div class="stat-num">{{ user.followers_count }}</div>
                <div class="stat-label">Followers</div>
            </div>
            <div class="p-stat-box">
                <div class="stat-num">{{ user.following_count }}</div>
                <div class="stat-label">Following</div>
            </div>
            <div class="p-stat-box">
                <div class="stat-num">{{ likes_count }}</div>
                <div class="stat-label">Likes</div>
            </div>
        </div>

        <div style="display:flex; justify-content:center; gap:10px; margin-top:20px;">
            <button class="primary-btn" style="width: auto; padding: 10px 30px; margin:0; font-size: 0.9em;"
                onclick="openEditProfile()">Editar Perfil</button>
        </div>
    </div>

    <!-- Video Grid -->
    <div class="profile-grid">
        {% for video in videos %}
        <div class="grid-item">
            <video src="{{ video.url }}" onclick="window.location.href='/'"></video>
            <div
                style="position:absolute; bottom:5px; left:5px; color:white; font-size:0.8em; text-shadow:1px 1px 2px black;">
                ‚ô• {{ video.likes }}
            </div>
        </div>
        {% else %}
        <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #555;">
            <p>Nenhum v√≠deo ainda.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Edit Modal -->
    <div id="editProfileModal" class="modal-overlay">
        <div class="modal-box">
            <h2>Editar Perfil</h2>
            <div class="input-group">
                <label style="font-size:0.8em; color:#aaa;">Foto URL</label>
                <input type="text" id="editPic" value="{{ user.profile_pic }}">
            </div>
            <div class="input-group">
                <label style="font-size:0.8em; color:#aaa;">Bio</label>
                <input type="text" id="editBio" value="{{ user.bio if user.bio else '' }}">
            </div>
            <button class="primary-btn" onclick="saveProfile()">Salvar</button>
            <button class="primary-btn" style="background:#333; margin-top:10px;"
                onclick="document.getElementById('editProfileModal').style.display='none'">Cancelar</button>
        </div>
    </div>

    <script>
        function openEditProfile() {
            document.getElementById('editProfileModal').style.display = 'flex';
        }

        async function saveProfile() {
            const bio = document.getElementById('editBio').value;
            const pic = document.getElementById('editPic').value;

            const fd = new FormData();
            fd.append('bio', bio);
            fd.append('profile_pic', pic);

            try {
                const res = await fetch('/update_profile', { method: 'POST', body: fd });
                if (res.ok) {
                    window.location.reload();
                } else {
                    alert('Erro ao atualizar');
                }
            } catch (e) { console.error(e); }
        }
    </script>
</body>

</html>